"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const A=Symbol("Comlink.proxy"),z=Symbol("Comlink.endpoint"),N=Symbol("Comlink.releaseProxy"),k=Symbol("Comlink.finalizer"),w=Symbol("Comlink.thrown"),M=t=>typeof t=="object"&&t!==null||typeof t=="function",v={canHandle:t=>M(t)&&t[A],serialize(t){const{port1:e,port2:r}=new MessageChannel;return x(t,e),[r,[r]]},deserialize(t){return t.start(),R(t)}},F={canHandle:t=>M(t)&&w in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},S=new Map([["proxy",v],["throw",F]]);function H(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function x(t,e=globalThis,r=["*"]){e.addEventListener("message",function a(n){if(!n||!n.data)return;if(!H(r,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:i,type:d,path:l}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(h);let s;try{const o=l.slice(0,-1).reduce((c,y)=>c[y],t),f=l.reduce((c,y)=>c[y],t);switch(d){case"GET":s=f;break;case"SET":o[l.slice(-1)[0]]=h(n.data.value),s=!0;break;case"APPLY":s=f.apply(o,u);break;case"CONSTRUCT":{const c=new f(...u);s=D(c)}break;case"ENDPOINT":{const{port1:c,port2:y}=new MessageChannel;x(t,y),s=W(c,[c])}break;case"RELEASE":s=void 0;break;default:return}}catch(o){s={value:o,[w]:0}}Promise.resolve(s).catch(o=>({value:o,[w]:0})).then(o=>{const[f,c]=E(o);e.postMessage(Object.assign(Object.assign({},f),{id:i}),c),d==="RELEASE"&&(e.removeEventListener("message",a),O(e),k in t&&typeof t[k]=="function"&&t[k]())}).catch(o=>{const[f,c]=E({value:new TypeError("Unserializable return value"),[w]:0});e.postMessage(Object.assign(Object.assign({},f),{id:i}),c)})}),e.start&&e.start()}function L(t){return t.constructor.name==="MessagePort"}function O(t){L(t)&&t.close()}function R(t,e){const r=new Map;return t.addEventListener("message",function(n){const{data:i}=n;if(!i||!i.id)return;const d=r.get(i.id);if(d)try{d(i)}finally{r.delete(i.id)}}),P(t,r,[],e)}function m(t){if(t)throw new Error("Proxy has been released and is not useable")}function _(t){return g(t,new Map,{type:"RELEASE"}).then(()=>{O(t)})}const b=new WeakMap,p="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(b.get(t)||0)-1;b.set(t,e),e===0&&_(t)});function V(t,e){const r=(b.get(e)||0)+1;b.set(e,r),p&&p.register(t,e,t)}function j(t){p&&p.unregister(t)}function P(t,e,r=[],a=function(){}){let n=!1;const i=new Proxy(a,{get(d,l){if(m(n),l===N)return()=>{j(i),_(t),e.clear(),n=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const u=g(t,e,{type:"GET",path:r.map(s=>s.toString())}).then(h);return u.then.bind(u)}return P(t,e,[...r,l])},set(d,l,u){m(n);const[s,o]=E(u);return g(t,e,{type:"SET",path:[...r,l].map(f=>f.toString()),value:s},o).then(h)},apply(d,l,u){m(n);const s=r[r.length-1];if(s===z)return g(t,e,{type:"ENDPOINT"}).then(h);if(s==="bind")return P(t,e,r.slice(0,-1));const[o,f]=T(u);return g(t,e,{type:"APPLY",path:r.map(c=>c.toString()),argumentList:o},f).then(h)},construct(d,l){m(n);const[u,s]=T(l);return g(t,e,{type:"CONSTRUCT",path:r.map(o=>o.toString()),argumentList:u},s).then(h)}});return V(i,t),i}function I(t){return Array.prototype.concat.apply([],t)}function T(t){const e=t.map(E);return[e.map(r=>r[0]),I(e.map(r=>r[1]))]}const C=new WeakMap;function W(t,e){return C.set(t,e),t}function D(t){return Object.assign(t,{[A]:!0})}function E(t){for(const[e,r]of S)if(r.canHandle(t)){const[a,n]=r.serialize(t);return[{type:"HANDLER",name:e,value:a},n]}return[{type:"RAW",value:t},C.get(t)||[]]}function h(t){switch(t.type){case"HANDLER":return S.get(t.name).deserialize(t.value);case"RAW":return t.value}}function g(t,e,r,a){return new Promise(n=>{const i=U();e.set(i,n),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),a)})}function U(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class q{constructor(){this.platformActions=[],this.parsers=[],this.application={downloadFile:async(e,r,a)=>await this._mainThread.downloadFile(e,r,a),downloadFiles:async(e,r)=>await this._mainThread.downloadFiles(e,r),feedback:async(e,r)=>await this._mainThread.feedback(e,r),quickPick:async e=>await this._mainThread.quickPick(e)},x({activate:this.activate.bind(this),deactivate:this.deactivate.bind(this),parsers:this._parsers.bind(this),platformActions:this._platformActions.bind(this)}),this._mainThread=R(self)}activate(){console.log("Extensão ativada (método base).")}deactivate(){console.log("Extensão desativada (método base).")}async _platformActions(e){const r=this.platformActions.flatMap(a=>"action"in a?[a]:a.actions).find(a=>a.key===e);if(!r)throw new Error(`Action with key "${e}" not found`);return await r.action()}async _parsers(e,r){const a=this.parsers.find(n=>n.key===e);if(!a)throw new Error(`Parser with key "${e}" not found`);return await a.parser(r)}}exports.ExtensionBase=q;
//# sourceMappingURL=index.cjs.js.map
